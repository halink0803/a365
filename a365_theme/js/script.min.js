/*
* @Author: halink0803
* @Date:   2018-01-14 23:50:32
* @Last Modified by:   halink0803
* @Last Modified time: 2018-01-14 23:57:02
*/
var $=jQuery.noConflict();function printDiv(){var t=document.getElementById("siteContent"),e=window.open("","_blank");e.document.open(),e.document.write('<html><body onload="window.print()">'+t.innerHTML+"</html>"),e.document.close()}function close_window(){confirm("Bạn có chắc chắn thoát trang này ?")&&(window.location.href=NaN)}function save_all_click_out(t){var e="";switch(t){case"asq":e="asq_save_and_exit";break;case"mchat":e="mchat_save_and_exit";break;case"qol":e="qol_save_and_exit";break;case"atec":e="atec_save_and_exit"}$cache=$("#TestingManagerBeginTestForm").serialize(),$.ajax({type:"POST",dataType:"json",url:a365_ajax.ajax_url,data:$cache+"&action="+e,success:function(t){confirm("Bạn có chắc chắn thoát trang này ?")&&(window.location.href="../quan-ly-tre")}})}function updateQueryStringParameter(t,e,a){var n=new RegExp("([?&])"+e+"=.*?(&|$)","i"),i=-1!==t.indexOf("?")?"&":"?";return t.match(n)?t.replace(n,"$1"+e+"="+a+"$2"):t+i+e+"="+a}$(document).ready(function(){$(".datepicker").datepicker($.datepicker.regional.vi),$(".child-checkbox input:radio").click(function(){var t=$(this).closest("tr").attr("id");$(".action-btn-group a").removeAttr("disabled"),$(".edit-child").removeClass("hidden"),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:{action:"get_current_child",current_child_id:t},success:function(t){"Không tự kỷ"!=t.status&&""!=t.status&&null!=t.status?$(".tuky").removeClass("disabled"):"Không tự kỷ"==t.status?$(".tuky").addClass("disabled"):(null==t.status||t.status,$(".tuky").addClass("disabled"))}})}),$("#childBirth").datepicker({dateFormat:"dd-mm-yy"}),$("#mChatChildBirth").datepicker({dateFormat:"dd-mm-yy"}),$(".popup_reg_user").dialog({autoOpen:!1,width:"auto"}),$(".mchatNoLogin").click(function(t){var e=$("#fullname").val(),a=$("#area").val(),n=$("input[name='child_gender']:checked").val(),i=$("#dd").val(),o=$("#mm").val(),r=$("#yyyy").val(),l=$("#birthweek").val();""==e||""==a||""==n||""==i||""==o||""==r||""==l?$("#notice").html("Bạn cần điền đầy đủ các trường được đánh dấu (*)!"):($data=$("#NoLoginTestForm").serialize(),$("#notice").html("Vui lòng chờ trong giây lát ..."),$(".mchatNoLogin").prop("disabled",!0),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:$data+"&action=create_nologin_mchatr",success:function(t){window.location.href=t.page},error:function(t,e,a){alert(t.status)}}))}),$(".tinhDiemMchatr").click(function(t){var e=!0;$(".question-answer input:radio").each(function(){var t=$(this).attr("name");0==$("input:radio[name="+t+"]:checked").length&&(e=!1)}),e?($("#Modal_User_Info_Without_Login").modal({backdrop:"static",keyboard:!0}),$(".cancel").click(function(t){$("#Modal_User_Info_Without_Login").modal("hide")}),$(".get_result").click(function(t){var e=$("#age").val(),a=$("#role_user").val(),n=$("input[name='user_gender']:checked").val(),i=$("#UserJobAdd").val();""==e||""==a||""==n||"Khác"==a&&""==i?$("#notice2").html("Bạn cần điền đầy đủ các trường được đánh dấu (*)!"):($user_info=$("#Get_Result").serialize(),$("#notice2").html("Vui lòng chờ trong giây lát ..."),$(".get_result").prop("disabled",!0),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:$user_info+"&action=update_no_login_user_info_mchatr",success:function(e){$data=$("#TestingManagerBeginTestForm").serialize()+"&action=mchatr_save_result",t.preventDefault(),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:$data,success:function(t){window.location.href=t.page},error:function(t,e,a){alert(t.status),alert(a)}})},error:function(t,e,a){alert(t.status),alert(a)}}))})):alert("Bạn phải trả lời tất cả câu hỏi để xem kết quả!")}),$(".deleteChild").click(function(t){$current_child=$("input[name=child]:checked").val();var e={action:"a365_delete_child",current_child:$current_child};$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:e,success:function(t){window.location.reload(!0)},error:function(t,e,a){}})}),$(".deleteHistory").click(function(t){current_history=$("input[name=history]:checked").val(),type=$("input[name=history]:checked").parents().eq(2).find(".child-test-type label").text();var e={action:"a365_delete_history",current_history:current_history,type:type};$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:e,success:function(t){window.location.reload(!0)},error:function(t,e,a){}})}),$(".diagnose-information input").on("change",function(){1==$(this).val()?($(".diagnose-result").removeClass("hidden"),$(".diagnose-age").removeClass("hidden"),$(".diagnose-place").removeClass("hidden"),$(".diagnose-person").removeClass("hidden")):($(".diagnose-result").addClass("hidden"),$(".diagnose-age").addClass("hidden"),$(".diagnose-place").addClass("hidden"),$(".diagnose-person").addClass("hidden"))}),$("#number_per_page").change(function(){url=window.location.href,number=$("#number_per_page option:selected").val(),url=updateQueryStringParameter(url,"amount",number),window.location.href=url}),$(".noLogin").click(function(t){$("#Modal_ASQ_Without_Login").modal("show")}),$(".asqNoLogin").click(function(t){var e=$("#fullname").val(),a=$("#area").val(),n=$("input[name='child_gender']:checked").val(),i=$("#dd").val(),o=$("#mm").val(),r=$("#yyyy").val(),l=$("#birthweek").val();""==e||""==a||""==n||""==i||""==o||""==r||""==l?$("#notice").html("Bạn cần điền đầy đủ các trường được đánh dấu (*)!"):($data=$("#NoLoginTestForm").serialize(),$("#notice").html("Vui lòng chờ trong giây lát ..."),$(".asqNoLogin").prop("disabled",!0),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:$data+"&action=create_nologin_asq",success:function(t){window.location.href=t.page},error:function(t,e,a){alert(t.status)}}))}),$(".score-asq").click(function(t){t.preventDefault(),console.log("a day roi"),1==validateForm()&&(console.log(login),0==login?($("#Modal_User_Info_Without_Login").modal({backdrop:"static",keyboard:!0}),$(".cancel").click(function(t){$("#Modal_User_Info_Without_Login").modal("hide")}),$(".get_result").click(function(t){var e=$("#child_age").val(),a=$("#role_user").val(),n=$("input[name='user_gender']:checked").val(),i=$("#UserJobAdd").val();""==e||""==a||""==n||"Khác"==a&&""==i?$("#notice2").html("Bạn cần điền đầy đủ các trường được đánh dấu (*)!"):($user_info=$("#Get_Result").serialize(),$("#notice2").html("Vui lòng chờ trong giây lát ..."),$(".get_result").prop("disabled",!0),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:$user_info+"&action=update_no_login_user_info",success:function(t){$data=$("#TestingManagerBeginTestForm").serialize(),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:$data+"&action=calculate_score",success:function(t){window.location.href=t.page},error:function(t,e,a){alert(t.status),alert(a)}})},error:function(t,e,a){alert(t.status),alert(a)}}))})):($data=$("#TestingManagerBeginTestForm").serialize(),$("#notice2").html("Vui lòng chờ trong giây lát ..."),$(".score-asq").prop("disabled",!0),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:$data+"&action=calculate_score",success:function(t){window.location.href=t.page},error:function(t,e,a){alert(t.status),alert(a)}})))}),$(".history").click(function(t){$("#test-table").dataTable().fnDestroy(),table=$(".child-history .display tbody"),table.empty(),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:{action:"get_child_history"},success:function(t){if(0==t.length);else for(var e in t)"mchatr"==t[e].type?type="M-CHAT R":"asq"==t[e].type?type="ASQ":"qol"==t[e].type?type="QOL":"atec"==t[e].type?type="ATEC":"gumsue"==t[e].type?type=t[e].exercise_name:type="M-CHAT R/F",null!=t[e].end_at?status="Đã hoàn thành":status="Chưa hoàn thành",table.append('<tr><td class="child-checkbox"><label class="row-data"><input type="radio" name="history" id="radio-'+e+'" value="'+t[e].id+'" test-type="'+t[e].type+'"></label></td><td class="child-test-date"><label class="row-data" for="radio-'+e+'">'+t[e].begin_at+'</label></td><td class="child-test-type"><label class="row-data test-type" for="radio-'+e+'">'+type+'</label></td><td class="child-test-status"><label class="row-data status" for="radio-'+e+'">'+status+"</label></td></tr>");$("#test-table tfoot th.xxx").each(function(){var t=$(this).text();$(this).html('<input style="border: 1px solid black;border-radius: 4px;" type="text" placeholder=" '+t+'" />')}),test_table=$("#test-table").DataTable({dom:"BCrtlip",language:{emptyTable:"Không có lịch sử để hiển thị cho trẻ hiện tại.",info:"Hiển thị _START_ đến _END_ của _TOTAL_ bản ghi",infoEmpty:"Hiển thị 0 đến 0 của 0 bản ghi",infoFiltered:"(Tìm kiếm từ _MAX_ bản ghi)",lengthMenu:"Hiển thị _MENU_ kết quả/trang",loadingRecords:"Đang tải ...",processing:"Đang xử lý...",search:"TÌm kiếm:",zeroRecords:"Không có bản ghi nào phù hợp",paginate:{first:"First",last:"Last",next:"Trang tiếp",previous:"Trang trước"}}}),test_table.columns().every(function(){var t=this;$("input",this.footer()).on("keyup change",function(){t.search()!==this.value&&t.search(this.value).draw()})}),$(".child-history").removeClass("hidden")},error:function(t,e,a){}})}),$(".child-history").on("click","input:radio",function(){$(".history-action").hasClass("hidden")&&$(".history-action").removeClass("hidden"),"Chưa hoàn thành"==$(this).closest("tr").find(".status").text()?($("#lamtiep").removeClass("disabled"),$("#lamtiep").removeClass("hidden")):$("#lamtiep").addClass("disabled"),test_type=$(this).attr("test-type"),test_id=$(this).val(),link2="",data={action:"set_result_id",test_type:test_type,test_id:test_id},$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:data,success:function(t){"asq"==test_type?(link=$(".asq-result-link").attr("link"),link2=$(".asq-continue-link").attr("link")):"mchatr"==test_type?link=$(".mchatr-result-link").attr("link"):"qol"==test_type?(link=$(".qol-result-link").attr("link"),link2=$(".qol-continue-link").attr("link")):"atec"==test_type?(link=$(".atec-result-link").attr("link"),link2=$(".atec-continue-link").attr("link")):"gumsue"==test_type?link=$(".gumsue-result-link").attr("link"):link=$(".mchatrf-result-link").attr("link"),$(".view-result").attr("href",link),$(".continue-test").attr("href",link2)}})}),$(".next_question").click(function(){var t=!0;$("input:radio").each(function(){var e=$(this).attr("name");0==$("input:radio[name="+e+"]:checked").length&&(t=!1)}),t?(question_number=$(".current_question").attr("current_question"),follow_question=$(".follow-question-number").attr("question_number"),answer=$("#follow_question").serialize(),$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:answer+"&action=load_follow_up_question&question_number="+question_number+"&follow_question="+follow_question,success:function(t){if(""==t.content)$.ajax({type:"post",dataType:"json",url:a365_ajax.ajax_url,data:{action:"a365_update_mchatrf_result"},success:function(t){url=$(".result-page").attr("result_url"),window.location.href=url}});else{if($(".follow-question-number").empty(),$(".follow-question-number").attr("question_number",t.number),$(".follow-question-content").html(t.content),$(".question_options table").empty(),"10"==t.question_number&2==t.number||"11"==t.question_number&2==t.number||"12"==t.question_number&3==t.number||"16"==t.question_number&2==t.number||"1"==t.question_number&2==t.number){$(".question_options table").append("<tr>");for(var e in t.options)$(".question_options table").append('<th style="vertical-align: bottom; font-weight: normal;">'+t.options[e]+'<input style="display: block; margin-left: 50px;" type="radio" name="option-0" value="'+(1-e)+'"></th>');$(".question_options table").append("</tr>")}else if("2"==t.question_number&3==t.number)for(var e in t.options)$(".question_options table").append('<div style="font-weight: normal;"><input type="radio" name="option-0" value="'+e+'">'+t.options[e]+"</div>");else{for(var e in t.options)$(".question_options table").append('<tr><th style="width: 80%; padding-right: 20px;"><label for="follow_question" style="font-weight: normal;">'+t.options[e]+'</label></th><th style="vertical-align: top; font-weight: normal;"><input type="radio" name="option-'+e+'" value="1"> Có</th><th style="vertical-align: top; font-weight: normal;"><input type="radio" name="option-'+e+'" value="0"> Không</th></tr>');0==t.options.length&&$(".question_options table").append('<th style="font-weight: normal;"><input type="radio" name="option-0" value="1">Có</th><th style="font-weight: normal;"><input type="radio" name="option-0" value="0"> Không</th>')}$(".current_question").attr("current_question",t.question_number),$(".current_question").empty(),$(".current_question").html("Câu "+t.question_number+":"),$(".question-content").empty(),$(".question-content").html(t.pre_question),"0"==t.pre_answer?answer="Không":answer="Có",$(".your-answer").empty().html("Câu trả lời của bạn: "+answer)}},error:function(t,e,a){}})):alert("Bạn phải trả lời tất cả câu hỏi để xem kết quả!")}),$(".previous_question").click(function(){})});